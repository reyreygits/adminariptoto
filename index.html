<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ARIPTOTO - Admin Panel</title>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<style>
body{background:#0a0f1c;color:white;font-family:Arial,sans-serif;margin:0;padding:20px;}
button{padding:5px 10px;margin:2px;border:none;border-radius:5px;cursor:pointer;}
.approve{background:#00cc66;color:white;}
.reject{background:#ff4444;color:white;}
</style>
</head>
<body>
<h2>Admin Panel - Pending Deposit & Withdraw</h2>
<div id="pendingList"></div>

<script>
// Firebase config sama dengan user
const firebaseConfig = {
  apiKey:"AIzaSyBC8UXFcrJaxMsJsTQgnqaaNvgsAVz0vOE",
  authDomain:"ariptoto-web.firebaseapp.com",
  projectId:"ariptoto-web",
  storageBucket:"ariptoto-web.appspot.com",
  messagingSenderId:"129200594109",
  appId:"1:129200594109:web:50f7f4ce89a384211b2bd4"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Load semua pending
async function loadPending(){
  const div = document.getElementById('pendingList');
  div.innerHTML='Loading...';
  const snapshot = await db.collection('users').get();
  div.innerHTML='';
  snapshot.forEach(doc=>{
    const user = doc.id;
    const data = doc.data();

    // Deposit pending
    (data.historyDeposit||[]).forEach((dep,i)=>{
      if(dep.status==='pending'){
        const el = document.createElement('div');
        el.innerHTML = `<strong>${user}</strong> Deposit Rp ${dep.amount} 
          <button onclick="approveDeposit('${user}',${i},${dep.amount})" class="approve">Approve</button>
          <button onclick="rejectDeposit('${user}',${i})" class="reject">Reject</button>`;
        div.appendChild(el);
      }
    });

    // Withdraw pending
    (data.historyWithdraw||[]).forEach((w,i)=>{
      if(w.status==='pending'){
        const el = document.createElement('div');
        el.innerHTML = `<strong>${user}</strong> Withdraw Rp ${w.amount} 
          <button onclick="approveWithdraw('${user}',${i},${w.amount})" class="approve">Approve</button>
          <button onclick="rejectWithdraw('${user}',${i})" class="reject">Reject</button>`;
        div.appendChild(el);
      }
    });
  });
}

// Approve deposit
async function approveDeposit(user,i,amt){
  const docRef = db.collection('users').doc(user);
  const doc = await docRef.get();
  const data = doc.data();
  data.balance = (data.balance||0)+amt;
  data.historyDeposit[i].status='approved';
  await docRef.update({balance:data.balance,historyDeposit:data.historyDeposit});
  loadPending();
}

// Reject deposit
async function rejectDeposit(user,i){
  const docRef = db.collection('users').doc(user);
  const doc = await docRef.get();
  const data = doc.data();
  data.historyDeposit[i].status='rejected';
  await docRef.update({historyDeposit:data.historyDeposit});
  loadPending();
}

// Approve withdraw
async function approveWithdraw(user,i,amt){
  const docRef = db.collection('users').doc(user);
  const doc = await docRef.get();
  const data = doc.data();
  if((data.balance||0)<amt){alert('Saldo tidak cukup'); return;}
  data.balance -= amt;
  data.historyWithdraw[i].status='approved';
  await docRef.update({balance:data.balance,historyWithdraw:data.historyWithdraw});
  loadPending();
}

// Reject withdraw
async function rejectWithdraw(user,i){
  const docRef = db.collection('users').doc(user);
  const doc = await docRef.get();
  const data = doc.data();
  data.historyWithdraw[i].status='rejected';
  await docRef.update({historyWithdraw:data.historyWithdraw});
  loadPending();
}

// Load on start
loadPending();
</script>
</body>
</html>
