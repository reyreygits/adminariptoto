<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin ARIPTOTO</title>
  <style>
    body {
      background: #0a0f1c;
      color: white;
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
    }
    header {
      background: #111a33;
      padding: 15px 20px;
      font-size: 22px;
      font-weight: bold;
      color: #FFD700;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      user-select: none;
    }
    main {
      max-width: 1200px;
      margin: 20px auto;
      padding: 0 15px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      color: white;
    }
    th, td {
      border: 1px solid #555;
      padding: 10px 8px;
      text-align: center;
      font-size: 14px;
    }
    th {
      background: #222f5f;
      color: #FFD700;
    }
    tr:nth-child(even) {
      background: #1c244f;
    }
    input[type=text], input[type=password], input[type=number], input[type=date] {
      width: 100%;
      padding: 6px 8px;
      border-radius: 5px;
      border: none;
      font-size: 14px;
      box-sizing: border-box;
    }
    button {
      padding: 7px 12px;
      background: #FFD700;
      border: none;
      border-radius: 6px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s ease;
      margin-top: 5px;
      width: 100%;
    }
    button:hover {
      background: #ffaa00;
    }
    .action-group {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 15px;
    }
    .action-group > div {
      flex: 1 1 200px;
    }
    .section-title {
      font-size: 20px;
      margin-top: 30px;
      color: #FFD700;
      border-bottom: 2px solid #FFD700;
      padding-bottom: 5px;
    }
    .msg {
      margin-top: 10px;
      color: #00cc66;
      font-weight: bold;
    }
    @media(max-width: 768px){
      .action-group {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>

<header>Admin Panel - ARIPTOTO</header>
<main>

  <div>
    <button onclick="loadUsers()">Muat Data Pemain</button>
  </div>

  <!-- Filter/Search -->
  <div class="action-group">
    <div>
      <input type="text" id="searchUserId" placeholder="Cari berdasarkan User ID" oninput="loadUsers()" />
    </div>
    <div>
      <input type="date" id="searchJoinDate" oninput="loadUsers()" />
    </div>
    <div>
      <button onclick="resetSearch()">Reset Filter</button>
    </div>
  </div>

  <div class="section-title">Daftar Pemain Terdaftar</div>
  <table id="usersTable">
    <thead>
      <tr>
        <th>User ID</th>
        <th>Password</th>
        <th>Saldo (Rp)</th>
        <th>No. Rekening</th>
        <th>Nama Rekening</th>
        <th>No. HP</th>
        <th>Bank / E-Wallet</th>
        <th>Tanggal Join</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody>
      <!-- Data user muncul di sini -->
    </tbody>
  </table>

  <div class="section-title">Edit Data Pemain</div>
  <div id="editSection" style="display:none;">
    <form id="editForm" onsubmit="return false;">
      <table style="width: 100%; max-width: 600px; margin-top: 10px;">
        <tr>
          <td>User ID:</td>
          <td><input type="text" id="editUserId" readonly /></td>
        </tr>
        <tr>
          <td>Ubah Password:</td>
          <td><input type="password" id="editPassword" placeholder="Kosongkan jika tidak ingin ganti" /></td>
        </tr>
        <tr>
          <td>Tambah Saldo (Rp):</td>
          <td><input type="number" id="addBalance" min="0" value="0" /></td>
        </tr>
        <tr>
          <td>Tarik Saldo (Rp):</td>
          <td><input type="number" id="withdrawBalance" min="0" value="0" /></td>
        </tr>
        <tr>
          <td>Nomor Rekening:</td>
          <td><input type="text" id="editRekNum" /></td>
        </tr>
        <tr>
          <td>Nama Rekening:</td>
          <td><input type="text" id="editRekName" /></td>
        </tr>
        <tr>
          <td>Nomor HP:</td>
          <td><input type="text" id="editPhone" /></td>
        </tr>
        <tr>
          <td>Bank / E-Wallet:</td>
          <td>
            <select id="editBankType">
              <option value="">-- Pilih Bank / Eâ€‘Wallet --</option>
              <option>Bank BCA</option>
              <option>Bank BNI</option>
              <option>Bank BRI</option>
              <option>Bank Mandiri</option>
              <option>DANA</option>
              <option>OVO</option>
              <option>Gopay</option>
              <option>ShopeePay</option>
            </select>
          </td>
        </tr>
        <tr>
          <td colspan="2">
            <button onclick="saveUserEdit()">Simpan Perubahan</button>
            <button type="button" onclick="cancelEdit()" style="background:#ff4444; margin-left: 10px;">Batal</button>
          </td>
        </tr>
      </table>
    </form>
    <div class="msg" id="editMsg"></div>
  </div>

</main>

<script>
  let usersData = {};
  let currentEditUser = null;

  function loadUsers() {
    usersData = JSON.parse(localStorage.getItem('users')) || {};

    // Tambahkan joinDate jika belum ada
    let updated = false;
    for (const user in usersData) {
      if (!usersData[user].joinDate) {
        usersData[user].joinDate = new Date().toISOString().split('T')[0];
        updated = true;
      }
    }
    if (updated) {
      localStorage.setItem('users', JSON.stringify(usersData));
    }

    const tbody = document.querySelector('#usersTable tbody');
    tbody.innerHTML = '';

    const searchId = document.getElementById('searchUserId').value.toLowerCase();
    const searchDate = document.getElementById('searchJoinDate').value;

    const filteredUsers = Object.entries(usersData).filter(([userId, u]) => {
      const idMatch = userId.toLowerCase().includes(searchId);
      const dateMatch = searchDate ? (u.joinDate === searchDate) : true;
      return idMatch && dateMatch;
    });

    if (filteredUsers.length === 0) {
      tbody.innerHTML = `<tr><td colspan="9">Tidak ditemukan pemain yang cocok.</td></tr>`;
      return;
    }

    for (const [user, u] of filteredUsers) {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${user}</td>
        <td>********</td>
        <td>${(u.balance || 0).toLocaleString()}</td>
        <td>${u.rekening || ''}</td>
        <td>${u.namaRekening || ''}</td>
        <td>${u.phone || ''}</td>
        <td>${u.bank || ''}</td>
        <td>${u.joinDate || '-'}</td>
        <td>
          <button onclick="editUser('${user}')">Edit</button>
        </td>
      `;
      tbody.appendChild(tr);
    }

    hideEditSection();
  }

  function resetSearch() {
    document.getElementById('searchUserId').value = '';
    document.getElementById('searchJoinDate').value = '';
    loadUsers();
  }

  function editUser(userId) {
    currentEditUser = userId;
    const u = usersData[userId];
    if(!u) return;

    document.getElementById('editUserId').value = userId;
    document.getElementById('editPassword').value = '';
    document.getElementById('addBalance').value = 0;
    document.getElementById('withdrawBalance').value = 0;
    document.getElementById('editRekNum').value = u.rekening || '';
    document.getElementById('editRekName').value = u.namaRekening || '';
    document.getElementById('editPhone').value = u.phone || '';
    document.getElementById('editBankType').value = u.bank || '';

    document.getElementById('editMsg').textContent = '';
    showEditSection();
  }

  function showEditSection() {
    document.getElementById('editSection').style.display = 'block';
  }
  function hideEditSection() {
    document.getElementById('editSection').style.display = 'none';
  }

  function saveUserEdit() {
    if(!currentEditUser) return;

    let u = usersData[currentEditUser];

    const newPass = document.getElementById('editPassword').value.trim();
    if(newPass){
      u.password = newPass;
    }

    const addBal = parseInt(document.getElementById('addBalance').value) || 0;
    if(addBal > 0){
      u.balance = (u.balance || 0) + addBal;
    }

    const withdrawBal = parseInt(document.getElementById('withdrawBalance').value) || 0;
    if(withdrawBal > 0){
      if(withdrawBal > (u.balance || 0)){
        alert('Saldo tidak cukup untuk penarikan!');
        return;
      } else {
        u.balance -= withdrawBal;
      }
    }

    const rekNum = document.getElementById('editRekNum').value.trim();
    const rekName = document.getElementById('editRekName').value.trim();
    const phone = document.getElementById('editPhone').value.trim();
    const bank = document.getElementById('editBankType').value;

    if(!rekNum || !rekName || !phone || !bank) {
      alert('Semua field rekening, nama, phone, dan bank harus diisi!');
      return;
    }

    u.rekening = rekNum;
    u.namaRekening = rekName;
    u.phone = phone;
    u.bank = bank;

    usersData[currentEditUser] = u;
    localStorage.setItem('users', JSON.stringify(usersData));

    document.getElementById('editMsg').textContent = `Data pemain ${currentEditUser} berhasil disimpan!`;
    loadUsers();
  }

  function cancelEdit(){
    currentEditUser = null;
    hideEditSection();
  }

  window.onload = () => {
    loadUsers();
  }
</script>

</body>
</html>
