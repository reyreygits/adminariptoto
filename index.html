<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ARIPTOTO - Admin Panel</title>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<style>
body {margin:0;font-family:Arial,sans-serif;background:#0a0f1c;color:white;}
header {background:#111a33;padding:10px 20px;display:flex;justify-content:space-between;align-items:center;}
.logo{font-weight:bold;color:#FFD700;font-size:22px;}
button{padding:6px 12px;border:none;border-radius:5px;cursor:pointer;margin:2px;}
.btn-approve{background:#00cc66;color:white;}
.btn-reject{background:#ff4444;color:white;}
.btn-edit{background:#ffaa00;color:black;}
.container{padding:20px;}
table{width:100%;border-collapse:collapse;margin-bottom:30px;}
th,td{border:1px solid #444;padding:8px;text-align:center;}
th{background:#222;color:#FFD700;}
input{padding:4px;border-radius:4px;border:none;width:100%;}
</style>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyBC8UXFcrJaxMsJsTQgnqaaNvgsAVz0vOE",
  authDomain: "ariptoto-web.firebaseapp.com",
  projectId: "ariptoto-web",
  storageBucket: "ariptoto-web.appspot.com",
  messagingSenderId: "129200594109",
  appId: "1:129200594109:web:50f7f4ce89a384211b2bd4"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Load semua users
async function loadUsers() {
  const snapshot = await db.collection('users').get();
  const tbody = document.getElementById('usersBody');
  tbody.innerHTML = '';
  snapshot.forEach(doc => {
    const data = doc.data();
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${doc.id}</td>
      <td><input value="${data.password}" onchange="updateField('${doc.id}','password',this.value)"></td>
      <td><input value="${data.namaRekening}" onchange="updateField('${doc.id}','namaRekening',this.value)"></td>
      <td><input value="${data.rekening}" onchange="updateField('${doc.id}','rekening',this.value)"></td>
      <td><input value="${data.bank}" onchange="updateField('${doc.id}','bank',this.value)"></td>
      <td><input value="${data.phone}" onchange="updateField('${doc.id}','phone',this.value)"></td>
      <td>${data.balance}</td>
      <td>
        <button class="btn-edit" onclick="addSaldo('${doc.id}')">Tambah Saldo</button>
        <button class="btn-reject" onclick="resetID('${doc.id}')">Reset ID</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

// Load semua deposit
async function loadDeposits() {
  const snapshot = await db.collection('deposits').orderBy('createdAt','desc').get();
  const tbody = document.getElementById('depositBody');
  tbody.innerHTML = '';
  snapshot.forEach(doc => {
    const data = doc.data();
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${doc.id}</td>
      <td>${data.user}</td>
      <td>${data.amount}</td>
      <td>${data.status}</td>
      <td>
        ${data.status==='pending'?`
          <button class="btn-approve" onclick="updateDeposit('${doc.id','approved')">Approve</button>
          <button class="btn-reject" onclick="updateDeposit('${doc.id','rejected')">Reject</button>
        `:''}
      </td>
    `;
    tbody.appendChild(tr);
  });
}

async function updateField(userId,field,value){
  await db.collection('users').doc(userId).update({[field]:value});
  alert('✅ Updated!');
}

async function addSaldo(userId){
  const amount = parseInt(prompt('Masukkan jumlah saldo tambahan:'));
  if(amount && amount>0){
    const userRef = db.collection('users').doc(userId);
    const doc = await userRef.get();
    if(doc.exists){
      const oldBalance = doc.data().balance || 0;
      await userRef.update({balance: oldBalance + amount});
      alert('✅ Saldo berhasil ditambahkan!');
      loadUsers();
    }
  }
}

async function resetID(userId){
  if(confirm('Yakin ingin reset user ini? Semua data akan hilang!')){
    await db.collection('users').doc(userId).delete();
    alert('✅ User berhasil dihapus!');
    loadUsers();
  }
}

async function updateDeposit(depositId,status){
  const depRef = db.collection('deposits').doc(depositId);
  const doc = await depRef.get();
  if(doc.exists){
    await depRef.update({status:status});
    if(status==='approved'){
      // Tambahkan saldo user
      const userId = doc.data().user;
      const amount = doc.data().amount;
      const userRef = db.collection('users').doc(userId);
      const userDoc = await userRef.get();
      if(userDoc.exists){
        const oldBalance = userDoc.data().balance || 0;
        await userRef.update({balance: oldBalance + amount});
      }
    }
    alert(`Deposit ${status}`);
    loadDeposits();
    loadUsers();
  }
}

window.onload = function(){
  loadUsers();
  loadDeposits();
};
</script>
</head>
<body>
<header>
  <div class="logo">ARIPTOTO - Admin Panel</div>
</header>
<div class="container">
<h2>Users</h2>
<table>
  <thead>
    <tr>
      <th>UserID</th>
      <th>Password</th>
      <th>Nama Rekening</th>
      <th>No Rekening</th>
      <th>Bank</th>
      <th>Phone</th>
      <th>Saldo</th>
      <th>Aksi</th>
    </tr>
  </thead>
  <tbody id="usersBody"></tbody>
</table>

<h2>Deposits</h2>
<table>
  <thead>
    <tr>
      <th>ID Deposit</th>
      <th>User</th>
      <th>Jumlah</th>
      <th>Status</th>
      <th>Aksi</th>
    </tr>
  </thead>
  <tbody id="depositBody"></tbody>
</table>
</div>
</body>
</html>
