<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ARIPTOTO - Admin Panel</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBC8UXFcrJaxMsJsTQgnqaaNvgsAVz0vOE",
  authDomain: "ariptoto-web.firebaseapp.com",
  projectId: "ariptoto-web",
  storageBucket: "ariptoto-web.appspot.com",
  messagingSenderId: "129200594109",
  appId: "1:129200594109:web:50f7f4ce89a384211b2bd4"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
</script>

<style>
body { font-family: Arial,sans-serif; background:#0a0f1c; color:white; margin:0; }
header { background:#111a33; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; }
.logo { font-size:22px; font-weight:bold; color:#FFD700; }
.page { display:none; max-width:1200px; margin:20px auto; padding:20px; }
.active { display:block; }
table { width:100%; border-collapse:collapse; margin-top:20px; }
th,td { border:1px solid #444; padding:8px; text-align:center; }
th { background:#222; color:#FFD700; }
td { background:#2a2a2a; }
.btn-action { padding:4px 8px; margin:2px; border-radius:4px; cursor:pointer; }
.btn-delete { background:#ff4444; color:white; }
.btn-approve { background:#00cc66; color:white; }
.btn-reject { background:#ff6666; color:white; }
.btn-edit { background:#ffcc00; color:black; }
input { width:80px; padding:2px; border-radius:3px; border:none; }
</style>
</head>
<body>

<!-- Admin Login -->
<div id="adminLogin" class="page active">
  <header><div class="logo">ARIPTOTO - Admin Login</div></header>
  <div style="text-align:center;margin-top:50px;">
    <input type="text" id="adminUser" placeholder="Admin User"><br><br>
    <input type="password" id="adminPass" placeholder="Password"><br><br>
    <button onclick="adminLogin()" style="padding:8px 16px;">Login</button>
  </div>
</div>

<!-- Admin Panel -->
<div id="adminPanel" class="page">
  <header><div class="logo">ARIPTOTO - Admin Panel</div>
  <div><button onclick="logoutAdmin()">Logout</button></div></header>

  <h2>Users List</h2>
  <table id="usersTable">
    <thead>
      <tr><th>UserID</th><th>Password</th><th>Rekening</th><th>Bank</th><th>Phone</th><th>Balance</th><th>Aksi</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>Deposits List</h2>
  <table id="depositsTable">
    <thead>
      <tr><th>UserID</th><th>Amount</th><th>Status</th><th>CreatedAt</th><th>Aksi</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

async function adminLogin(){
  const user=document.getElementById('adminUser').value.trim();
  const pass=document.getElementById('adminPass').value.trim();
  if(!user||!pass){ alert('Isi semua field'); return; }
  // Di sini bisa pakai admin hardcode atau cek dari collection 'adminUsers'
  if(user==='admin' && pass==='1234'){ 
    showPage('adminPanel'); 
    loadAdminData();
  }else{ alert('Admin salah'); }
}

function logoutAdmin(){ showPage('adminLogin'); }

async function loadAdminData(){
  const usersT=document.getElementById('usersTable').querySelector('tbody');
  usersT.innerHTML='';
  const users=await db.collection('users').get();
  users.forEach(u=>{
    const data=u.data();
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${u.id}</td>
      <td>${data.password}</td>
      <td><input value="${data.namaRekening}" onchange="updateUserField('${u.id}','namaRekening',this.value)"></td>
      <td><input value="${data.rekening}" onchange="updateUserField('${u.id}','rekening',this.value)"></td>
      <td>${data.phone}</td>
      <td><input value="${data.balance}" type="number" onchange="updateUserField('${u.id}','balance',parseInt(this.value))"></td>
      <td>
        <button class="btn-action btn-delete" onclick="deleteUser('${u.id}')">Hapus</button>
        <button class="btn-action btn-approve" onclick="resetPassword('${u.id}')">Reset Pass</button>
      </td>`;
    usersT.appendChild(tr);
  });

  const depsT=document.getElementById('depositsTable').querySelector('tbody');
  depsT.innerHTML='';
  const deps=await db.collection('deposits').orderBy('createdAt','desc').get();
  deps.forEach(d=>{
    const data=d.data();
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${data.user}</td>
      <td>${data.amount}</td>
      <td>${data.status}</td>
      <td>${data.createdAt}</td>
      <td>
        ${data.status==='pending'?`<button class="btn-action btn-approve" onclick="approveDeposit('${d.id}')">Approve</button>
        <button class="btn-action btn-reject" onclick="rejectDeposit('${d.id}')">Reject</button>`:''}
      </td>`;
    depsT.appendChild(tr);
  });
}

// Functions
async function deleteUser(uid){
  if(confirm('Hapus user '+uid+'?')){
    await db.collection('users').doc(uid).delete();
    alert('User dihapus');
    loadAdminData();
  }
}

async function resetPassword(uid){
  const newPass=prompt('Password baru untuk '+uid);
  if(newPass){
    await db.collection('users').doc(uid).update({password:newPass});
    alert('Password direset');
    loadAdminData();
  }
}

async function updateUserField(uid,field,value){
  await db.collection('users').doc(uid).update({[field]:value});
}

async function approveDeposit(depId){
  await db.collection('deposits').doc(depId).update({status:'approved'});
  const depDoc=await db.collection('deposits').doc(depId).get();
  const userRef=db.collection('users').doc(depDoc.data().user);
  await userRef.update({balance:firebase.firestore.FieldValue.increment(depDoc.data().amount)});
  alert('Deposit approved');
  loadAdminData();
}

async function rejectDeposit(depId){
  await db.collection('deposits').doc(depId).update({status:'rejected'});
  alert('Deposit rejected');
  loadAdminData();
}
</script>
</body>
</html>
